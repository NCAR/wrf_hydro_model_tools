README_ESMF_regridding_NLDAS2_2_WRF_HYDRO


PURPOSE:
Utilities to regrid NLDAS2 data to a smaller, completely encompassed WRF-Hydro domain. There are many ways to do this but the tools used here
use the ESMF regridding libraries contained within the 'ncl' software.

Created by: K. Ikeda, NCAR/RAL
Last updated: 7/22/2017     by K. FitzGerald & M. McAllister, NCAR/RAL


###########DATA ACQUISITION STEPS#########################
Acquire NLDAS2 data from NASA's data server https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/NLDAS_FORA0125_H.002/
See https://disc.gsfc.nasa.gov/data-access for information on how to access data. 
See How to Download Data Files from HTTP Service with wget https://disc.gsfc.nasa.gov/information/howto?title=How%20to%20Download%20Data%20Files%20from%20HTTP%20Service%20with%20wget
 
A script to convert the data from grib to netcdf (grib2nc.sh) is provided. Once you have acquired and converted NLDAS2 data to netcdf format, you will need to copy, move or link those files into your source data directory (input_files/) that is used in the regridding steps
below.


 
#############REGRIDDING STEPS#############################
VIP: The procedures and code discussed here have only been tested on ncl version:  NCAR Command Language Version 6.1.2
Things will likely not work on earlier versions.


The process to utilize ESMF regridding tools within the ncl programming language is a 2 step process. 
The steps are as follows:

1. Create regridding 'weight' files required by the ESMF regridders. The weight files are netcdf files
which specify interpolation weights between the source coordinate data grids (src) and destination coordinate data (dst) grids.
The weight file is generated by running the 'ESMF_genWgts_NLDAS2WRFHYDRO_forcing.ncl' script. User's will need
to input the source and destination grid filenames into the 'ESMF_genWgts_NLDAS2WRFHYDRO_forcing.ncl' program.


2. The second step is to then do the regridding using the 'WRF_HYDRO_sub_domain_forcing_regridder_ESMFregrid.ncl' script which
ingests both source data and the relevant weight file as inputs and then outputs regridded data on the destination grid.

Thus the 2 scripts used to do the regridding are:

ESMF_genWgts_NLDAS2WRFHYDRO_forcing.ncl

and

NLDAS2WRFHYDRO_forcing_regridder_ESMFregrid.ncl



Requirements: To run these scripts you will need the following:
1. a geogrid file from your 'destination' domain

2. your NLDAS2 data from its 'source' domain or grid.  At a minimum for WRF-Hydro you will need
the following NLDAS2 fields:

"lat_110"   - latitude
"lon_110"   - longitude
"PRES_110_SFC"   - pressure
"TMP_110_HTGL"   - air temperature
"U_GRD_110_HTGL" - wind speed - u direction
"V_GRD_110_HTGL" - wind speed - v direction
"SPF_H_110_HTGL" - specific humidity 
"A_PCP_110_SFC_acc1h" - accumulated precipitation
"DSWRF_110_SFC" - incoming shortwave radiation
"DLWRF_110_SFC" -incoming longwave radiation



Additional specific usage information for these scripts is provided in the header of the script codes.

#######################################################################################
Command line structure for running 'ESMF_genWgts_NLDAS2WRFHYDRO_forcing.ncl':
#######################################################################################

; Usage:     ncl 'interp_opt="conserve"' 'srcGridName="NLDAS_FORA0125_H.2013091200.nc"' 'dstGridName="geo_em.d01.nc.4mile_1km.nc"' ESMF_genWgts_NLDAS2WRFHYDRO_forcing.ncl
;
;            interp_opt = conserve / bilinear / patch      (this is the regridding method  or 'option' to be used by the ESMF regridders)
;            srcGridName = filename (with full path if necessary) to read source grid coordinates.  Users need to copy or link this file to the local directory where the script is executed.
;            dstGridName = filename of the destination WRF/WRF-Hydro geogrid file. This file needs to be local as well.

NOTES on the use of 'ESMF_genWgts_NLDAS2WRFHYDRO_forcing.ncl':
1. The script is presently set up to use the 'conserve' option in ESMF for all fields.
2. This script may take a while to run so be patient. Also, runtime increases with larger input or 'source' domain sizes and resolution. The script will tell you when it is done.




#######################################################################################
Command line structure for running 'NLDAS2WRFHYDRO_forcing_regridder_ESMFregrid.ncl':
#######################################################################################

; Usage:    ncl 'srcfilename="NLDAS_FORA0125_H.*.nc"' 'dstGridName="geo_em.d01.nc.4mile_1km.nc"' NLDAS2WRFHYDRO_forcing_regridder_ESMFregrid.ncl
;
;           srcfilename = filename pattern of the souce wrfout files. Should have matching domain number.
;                         e.g., "NLDAS_FORA0125_H.2013091300.nc", "NLDAS_FORA0125_H.*.nc"
;                               "NLDAS_FORA0125_H.2013091[2-5]00.nc"
;           dstGridName = filename for destination WRF/WRF-Hydro grid (usually your geogrid file...)

NOTES on the use of NLDAS2WRFHYDRO_forcing_regridder_ESMFregrid.ncl:
1. This script will use the regridding weight files created by the 'ESMF_genWgts_NLDAS2WRFHYDRO_forcing.ncl' script. Therefore, do not change the names of those files
or else this script will not be able to find them.
2. The source data to be regridded (NLDAS2 data in netcdf format) needs to be placed in a local directory called 'input_files/'
3. The output data created from this script will be placed in a local directory called 'output_files/'. If this directory is not present the script will create it.
