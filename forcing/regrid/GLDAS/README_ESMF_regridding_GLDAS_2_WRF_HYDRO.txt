README_ESMF_regridding_GLDAS_2_WRF_HYDRO


PURPOSE:
Utilities to regrid GLDAS data to a smaller, completely encompassed WRF-Hydro domain. There are many ways to do this but the tools used here
use the ESMF regridding libraries contained within the 'ncl' software.

Created by: Linlin Pan, NCAR/RAL 08/08/2017
Updated by M. McAllister NCAR/RAL 10/12/2017

 
#############REGRIDDING STEPS#############################
VIP: The procedures and code discussed here have only been tested on ncl version:  NCAR Command Language Version 6.1.2
Things will likely not work on earlier versions.


The process to utilize ESMF regridding tools within the ncl programming language is a 2 step process. 
The steps are as follows:

1. Create regridding 'weight' files required by the ESMF regridders. The weight files are netcdf files
which specify interpolation weights between the source coordinate data grids (src) and destination coordinate data (dst) grids.
The weight file is generated by running the 'ESMF_genWgts_GLDAS2HYDRO_forcing.ncl' script. User's will need
to input the source and destination grid filenames into the 'ESMF_genWgts_GLDASWRFHYDRO_forcing.ncl' program.


2. The second step is to then do the regridding using the 'GLDAS2Hydro_forcing_regridding.ncl' script which
ingests both source data and the relevant weight file as inputs and then outputs regridded data on the destination grid.

Thus the 2 scripts used to do the regridding are:

ESMF_genWgts_GLDAS2HYDRO_forcing.ncl

and

GLDAS2Hydro_forcing_regridding.ncl


Requirements: To run these scripts you will need the following:
1. a geogrid file from your 'destination' domain

2. your GLDAS data from its 'source' domain or grid.  At a minimum for WRF-Hydro you will need
the following GLDAS fields:

"lat_0"   - latitude
"lon_0"   - longitude
"VAR_209_6_9_P0_L102_GLL0" - accumulated precipitation


Additional specific usage information for these scripts is provided in the header of the script codes.

#######################################################################################
Command line structure for running 'ESMF_genWgts_GLDAS2HYDRO_forcing.ncl':
#######################################################################################

; Usage:     ncl 'interp_opt="conserve"' 'srcGridName="sourcefile"  'dstGridName="destinationfile"' ESMF_genWgts_GLDAS2HYDRO_forcing.ncl
;
;            interp_opt = conserve / bilinear / patch      (this is the regridding method  or 'option' to be used by the ESMF regridders)
;            srcGridName = filename (with full path if necessary) to read source grid coordinates.  Users need to copy or link this file to the local directory where the script is executed.
;            dstGridName = filename of the destination WRF/WRF-Hydro geogrid file. This file needs to be local as well.

NOTES on the use of 'ESMF_genWgts_GLDAS2HYDRO_forcing.ncl':
1. The script is presently set up to use the 'conserve' option in ESMF for all fields.
2. This script may take a while to run so be patient. Also, runtime increases with larger input or 'source' domain sizes and resolution. The script will tell you when it is done.

#######################################################################################
Command line structure for running 'GLDAS2HYDRO_forcing_regridding.ncl':
#######################################################################################

; Usage:  
; setenv srcFile GaugeCorr_QPE_00.00_20150722_000000.grib2
; setenv outFile 2015072200.nc
;   
;  ncl 'RUNNAME="GLDAS2HYDRO"' 'wrf_domain_name="d01"' 'dstGridName="geo_dst.nc"' 'wgtFileName_in="./GLDAS2HYDRO_d01_weight_bilinear.nc"' ./GLDAS2Hydro_forcing_regridding.ncl 
;

NOTES on the use of GLDAS2HYDRO_forcing_regridding.ncl:
1. This script will use the regridding weight files created by the 'ESMF_genWgts_GLDAS2HYDRO_forcing.ncl' script. Therefore, do not change the names of those files
or else this script will not be able to find them.
2. The source data to be regridded (GLDAS data in netcdf format) needs to be placed in a local directory called 'input_files/'
3. The output data created from this script will be placed in a local directory called 'output_files/'. If this directory is not present the script will create it.
